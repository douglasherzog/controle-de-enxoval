{% extends 'base.html' %}

{% block content %}
  <div class="grid">
    <section class="summary">
      <div class="summary-card">
        <span class="label">Pe√ßas ativas</span>
        <strong>{{ total_ativos }}</strong>
      </div>
      <div class="summary-card">
        <span class="label">Pendentes de retorno</span>
        <strong>{{ pendentes }}</strong>
      </div>
      <div class="summary-card">
        <span class="label">Extraviadas</span>
        <strong>{{ extraviados }}</strong>
      </div>
      <div class="summary-card">
        <span class="label">Em estoque</span>
        <strong>{{ status_counts.get('estoque', 0) }}</strong>
      </div>
    </section>
    <p class="helper">
      Passo a passo: 1) cadastre as pe√ßas, 2) registre cada movimenta√ß√£o, 3) acompanhe pend√™ncias e perdas.
    </p>
    <section class="card span-full">
      <h3>Alertas autom√°ticos</h3>
      <p class="helper">Pe√ßas em uso/entregues sem movimenta√ß√£o h√° mais de 2 dias.</p>
      <div class="alert-grid">
        <div class="summary-card">
          <span class="label">Aten√ß√£o (2+ dias)</span>
          <strong class="badge alerta">{{ alerta_total.atencao }}</strong>
        </div>
        <div class="summary-card">
          <span class="label">Cr√≠tico (4+ dias)</span>
          <strong class="badge critico">{{ alerta_total.critico }}</strong>
        </div>
      </div>
      <div class="grid">
        <section class="card span-2">
          <h4>Por setor</h4>
          <div class="alert-table-wrapper">
            <table class="alert-table">
              <thead>
                <tr>
                  <th>Setor</th>
                  <th>Aten√ß√£o</th>
                  <th>Cr√≠tico</th>
                  <th>Total</th>
                </tr>
              </thead>
              <tbody>
                {% for setor, atencao, critico, total in alertas_setor %}
                  <tr>
                    <td>{{ setor }}</td>
                    <td>{{ atencao }}</td>
                    <td>{{ critico }}</td>
                    <td>{{ total }}</td>
                  </tr>
                {% else %}
                  <tr>
                    <td colspan="4" class="muted">Sem alertas no momento.</td>
                  </tr>
                {% endfor %}
              </tbody>
              </table>
        </div>
          </div>
        </section>
        <section class="card span-2">
          <h4>Por colaborador</h4>
          <div class="alert-table-wrapper">
            <table class="alert-table">
              <thead>
                <tr>
                  <th>Colaborador</th>
                  <th>Aten√ß√£o</th>
                  <th>Cr√≠tico</th>
                  <th>Total</th>
                </tr>
              </thead>
              <tbody>
                {% for colaborador, atencao, critico, total in alertas_colaborador %}
                  <tr>
                    <td>{{ colaborador }}</td>
                    <td>{{ atencao }}</td>
                    <td>{{ critico }}</td>
                    <td>{{ total }}</td>
                  </tr>
                {% else %}
                  <tr>
                    <td colspan="4" class="muted">Sem alertas no momento.</td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </section>
      </div>
    </section>
    <section class="card span-full">
      <h3>Dashboard com gr√°ficos</h3>
      <div class="chart-grid">
        <section class="card">
          <h4>Status do enxoval</h4>
          <div class="donut" data-conic="{{ status_conic }}"></div>
          <div class="legend">
            {% for item in status_chart %}
              <div class="legend-item">
                <span class="legend-dot" data-color="{{ item.color }}"></span>
                <span>{{ item.status|replace('_', ' ') }} ({{ item.quantidade }})</span>
              </div>
            {% endfor %}
          </div>
        </section>
        <section class="card">
          <h4>Por tipo</h4>
          {% for tipo, total in por_tipo %}
            <div class="bar-row">
              <div class="bar-label">
                <span>{{ tipo }}</span>
                <span>{{ total }}</span>
              </div>
              <div class="bar-track">
                <div class="bar-fill" data-width="{% if max_tipo > 0 %}{{ (total / max_tipo) * 100 }}{% else %}0{% endif %}"></div>
              </div>
            </div>
          {% endfor %}
        </section>
        <section class="card">
          <h4>Por setor</h4>
          {% for setor, total in por_setor %}
            <div class="bar-row">
              <div class="bar-label">
                <span>{{ setor or 'Sem setor' }}</span>
                <span>{{ total }}</span>
              </div>
              <div class="bar-track">
                <div class="bar-fill" data-width="{% if max_setor > 0 %}{{ (total / max_setor) * 100 }}{% else %}0{% endif %}"></div>
              </div>
            </div>
          {% endfor %}
        </section>
      </div>
    </section>
    <section class="card span-full">
      <h3>Invent√°rio por tipo</h3>
      <p class="helper">Mostra quantas pe√ßas ativas existem por tipo (moletom, cal√ßa, bata...).</p>
      <table>
        <thead>
          <tr>
            <th>Tipo</th>
            <th>Quantidade</th>
          </tr>
        </thead>
        <tbody>
          {% for tipo, total in por_tipo %}
            <tr>
              <td>{{ tipo }}</td>
              <td>{{ total }}</td>
            </tr>
          {% else %}
            <tr>
              <td colspan="2" class="muted">Sem dados.</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </section>

    <section class="card span-full">
      <h3>Invent√°rio por setor</h3>
      <p class="helper">Ajuda a ver onde o enxoval est√° concentrado no frigor√≠fico.</p>
      <table>
        <thead>
          <tr>
            <th>Setor</th>
            <th>Quantidade</th>
          </tr>
        </thead>
        <tbody>
          {% for setor, total in por_setor %}
            <tr>
              <td>{{ setor or 'Sem setor' }}</td>
              <td>{{ total }}</td>
            </tr>
          {% else %}
            <tr>
              <td colspan="2" class="muted">Sem dados.</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </section>

    <section class="card span-full">
      <h3>Relat√≥rios Peri√≥dicos</h3>
      <p class="helper">Gere relat√≥rios de status para acompanhamento.</p>
      <div class="actions">
        <a href="{{ url_for('main.relatorio_status', periodo='diario') }}" class="button">üìä Di√°rio</a>
        <a href="{{ url_for('main.relatorio_status', periodo='semanal') }}" class="button">üìà Semanal</a>
        <a href="{{ url_for('main.relatorio_status', periodo='mensal') }}" class="button">üìâ Mensal</a>
      </div>
    </section>

    <section class="card span-full">
      <h3>Gerenciar Cadastros</h3>
      <p class="helper">Edite ou inative colaboradores, setores e tipos de pe√ßa.</p>
      
      <h4>Colaboradores</h4>
      <div class="table-scroll">
        <table>
          <thead>
            <tr>
              <th>Nome</th>
              <th>Telefone</th>
              <th>A√ß√µes</th>
            </tr>
          </thead>
          <tbody>
            {% for colaborador in colaboradores_ativos %}
              <tr>
                <td>{{ colaborador.nome }}</td>
                <td>{{ colaborador.telefone or '-' }}</td>
                <td>
                  <a href="{{ url_for('main.editar_colaborador', colaborador_id=colaborador.id) }}" class="back-link">‚úèÔ∏è Editar</a> |
                  <form method="post" action="{{ url_for('main.excluir_colaborador', colaborador_id=colaborador.id) }}" style="display:inline;" onsubmit="return confirm('Tem certeza que deseja excluir este colaborador?');">
                    <button type="submit" class="back-link" style="background:none;border:none;color:#e74c3c;cursor:pointer;">üóëÔ∏è Excluir</button>
                  </form>
                </td>
              </tr>
            {% else %}
              <tr>
                <td colspan="3" class="muted">Nenhum colaborador cadastrado.</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <h4>Setores</h4>
      <div class="table-scroll">
        <table>
          <thead>
            <tr>
              <th>Nome</th>
              <th>A√ß√µes</th>
            </tr>
          </thead>
          <tbody>
            {% for setor in setores_ativos %}
              <tr>
                <td>{{ setor.nome }}</td>
                <td>
                  <a href="{{ url_for('main.editar_setor', setor_id=setor.id) }}" class="back-link">‚úèÔ∏è Editar</a> |
                  <form method="post" action="{{ url_for('main.inativar_setor', setor_id=setor.id) }}" style="display:inline;" onsubmit="return confirm('Tem certeza que deseja inativar este setor?');">
                    <button type="submit" class="back-link" style="background:none;border:none;color:#e74c3c;cursor:pointer;">üóëÔ∏è Inativar</button>
                  </form>
                </td>
              </tr>
            {% else %}
              <tr>
                <td colspan="2" class="muted">Nenhum setor cadastrado.</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <h4>Tipos de Pe√ßa</h4>
      <div class="table-scroll">
        <table>
          <thead>
            <tr>
              <th>Nome</th>
              <th>A√ß√µes</th>
            </tr>
          </thead>
          <tbody>
            {% for tipo in tipos_peca_ativos %}
              <tr>
                <td>{{ tipo.nome }}</td>
                <td>
                  <a href="{{ url_for('main.editar_tipo_peca', tipo_id=tipo.id) }}" class="back-link">‚úèÔ∏è Editar</a> |
                  <form method="post" action="{{ url_for('main.inativar_tipo_peca', tipo_id=tipo.id) }}" style="display:inline;" onsubmit="return confirm('Tem certeza que deseja inativar este tipo?');">
                    <button type="submit" class="back-link" style="background:none;border:none;color:#e74c3c;cursor:pointer;">üóëÔ∏è Inativar</button>
                  </form>
                </td>
              </tr>
            {% else %}
              <tr>
                <td colspan="2" class="muted">Nenhum tipo cadastrado.</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <h4>Tamanhos</h4>
      <div class="table-scroll">
        <table>
          <thead>
            <tr>
              <th>Nome</th>
              <th>A√ß√µes</th>
            </tr>
          </thead>
          <tbody>
            {% for tamanho in tamanhos_ativos %}
              <tr>
                <td>{{ tamanho.nome }}</td>
                <td>
                  <a href="{{ url_for('main.editar_tamanho', tamanho_id=tamanho.id) }}" class="back-link">‚úèÔ∏è Editar</a> |
                  <form method="post" action="{{ url_for('main.inativar_tamanho', tamanho_id=tamanho.id) }}" style="display:inline;" onsubmit="return confirm('Tem certeza que deseja inativar este tamanho?');">
                    <button type="submit" class="back-link" style="background:none;border:none;color:#e74c3c;cursor:pointer;">üóëÔ∏è Inativar</button>
                  </form>
                </td>
              </tr>
            {% else %}
              <tr>
                <td colspan="2" class="muted">Nenhum tamanho cadastrado.</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <h4>Cadastrar Novo Tamanho</h4>
      <form method="post" action="{{ url_for('main.criar_tamanho') }}" class="span-full">
        <label for="nome_tamanho">Nome do Tamanho</label>
        <input id="nome_tamanho" name="nome" placeholder="Ex.: XG, PP, 42, etc." required>
        <button type="submit">Cadastrar Tamanho</button>
      </form>
    </section>

    <section class="card span-full">
      <h3>Importar enxoval (CSV)</h3>
      <p class="helper">Use quando tiver muitas pe√ßas para cadastrar de uma vez.</p>
      <form method="post" action="{{ url_for('main.importar_csv') }}" enctype="multipart/form-data">
        <label for="arquivo">Arquivo CSV</label>
        <input id="arquivo" name="arquivo" type="file" accept=".csv" required>
        <button type="submit">Importar</button>
      </form>
    </section>

    <form method="post" class="span-full">
      <span class="step">Passo 1</span>
      <p class="helper">Cadastre cada pe√ßa com c√≥digo √∫nico. RFID √© opcional.</p>
      <label for="nome">Tipo</label>
      <select id="nome" name="nome" required>
        <option value="">‚Äî Selecione ‚Äî</option>
        <option value="__novo__">+ Cadastrar novo tipo</option>
        {% for tipo in tipos_peca_ativos %}
          <option value="{{ tipo.nome }}">{{ tipo.nome }}</option>
        {% endfor %}
      </select>

      <div id="novo-tipo-container" style="display:none; margin-top:8px;">
        <label for="novo_tipo_nome">Nome do novo tipo</label>
        <input id="novo_tipo_nome" name="novo_tipo_nome" placeholder="Ex.: Jaleco t√©rmico">
      </div>

      <label for="codigo">C√≥digo/Rastreio</label>
      <input id="codigo" name="codigo" placeholder="Ex.: JAL-0001" required>

      <label for="tag_rfid">Tag RFID (opcional)</label>
      <input id="tag_rfid" name="tag_rfid" placeholder="Ex.: RFID-0001">

      <label for="tamanho">Tamanho</label>
      <select id="tamanho" name="tamanho" required>
        <option value="">Selecione</option>
        <option value="__novo__">+ Cadastrar novo tamanho</option>
        {% for tamanho in tamanhos_ativos %}
          <option value="{{ tamanho.nome }}">{{ tamanho.nome }}</option>
        {% endfor %}
      </select>

      <div id="novo-tamanho-container" style="display:none; margin-top:8px;">
        <label for="novo_tamanho_nome">Nome do novo tamanho</label>
        <input id="novo_tamanho_nome" name="novo_tamanho_nome" placeholder="Ex.: XG, PP, 42, etc.">
      </div>

      <label for="tamanho_customizado">Detalhe sob medida (opcional)</label>
      <input id="tamanho_customizado" name="tamanho_customizado" placeholder="Ex.: ajuste de manga, nome do colaborador">

      <label for="colaborador">Colaborador (opcional)</label>
      <select id="colaborador" name="colaborador">
        <option value="">‚Äî Selecione ‚Äî</option>
        <option value="__novo__">+ Cadastrar novo colaborador</option>
        {% for colaborador in colaboradores_ativos %}
          <option value="{{ colaborador.nome }}">{{ colaborador.nome }}</option>
        {% endfor %}
      </select>

      <div id="novo-colaborador-container" style="display:none; margin-top:8px;">
        <label for="novo_colaborador_nome">Nome do novo colaborador</label>
        <input id="novo_colaborador_nome" name="novo_colaborador_nome" placeholder="Ex.: Jo√£o Silva">
        <label for="novo_colaborador_telefone">Telefone (opcional)</label>
        <input id="novo_colaborador_telefone" name="novo_colaborador_telefone" placeholder="Ex.: (51) 99999-9999">
      </div>

      <label for="setor">Setor (opcional)</label>
      <select id="setor" name="setor">
        <option value="">‚Äî Selecione ‚Äî</option>
        <option value="__novo__">+ Cadastrar novo setor</option>
        {% for setor in setores_ativos %}
          <option value="{{ setor.nome }}">{{ setor.nome }}</option>
        {% endfor %}
      </select>

      <div id="novo-setor-container" style="display:none; margin-top:8px;">
        <label for="novo_setor_nome">Nome do novo setor</label>
        <input id="novo_setor_nome" name="novo_setor_nome" placeholder="Ex.: Desossa">
      </div>

      <label for="descricao">Descri√ß√£o</label>
      <textarea id="descricao" name="descricao" placeholder="Detalhes, tamanho, setor..."></textarea>

      <button type="submit">Cadastrar</button>
    </form>

    <section class="card span-full">
      <h3>Lista de pe√ßas</h3>
      <p class="helper">Use filtros para encontrar rapidamente. A lista √© paginada.</p>
      <form method="get" class="filters">
        <div>
          <label for="busca">Busca</label>
          <input id="busca" name="busca" value="{{ busca }}" placeholder="Ex.: MO-0001 ou moletom">
        </div>
        <div>
          <label for="status">Status</label>
          <select id="status" name="status">
            <option value="">Todos</option>
            {% for status in status_options %}
              <option value="{{ status }}" {% if status == filtro_status %}selected{% endif %}>{{ status|replace('_', ' ') }}</option>
            {% endfor %}
          </select>
        </div>
        <div>
          <label for="setor-filtro">Setor</label>
          <select id="setor-filtro" name="setor">
            <option value="">Todos</option>
            <option value="__sem__" {% if filtro_setor == "__sem__" %}selected{% endif %}>Sem setor</option>
            {% for setor in setores_ativos %}
              <option value="{{ setor.nome }}" {% if setor.nome == filtro_setor %}selected{% endif %}>{{ setor.nome }}</option>
            {% endfor %}
          </select>
        </div>
        <div>
          <label for="colaborador-filtro">Colaborador</label>
          <select id="colaborador-filtro" name="colaborador">
            <option value="">Todos</option>
            <option value="__sem__" {% if filtro_colaborador == "__sem__" %}selected{% endif %}>Sem colaborador</option>
            {% for colaborador in colaboradores_ativos %}
              <option value="{{ colaborador.nome }}" {% if colaborador.nome == filtro_colaborador %}selected{% endif %}>{{ colaborador.nome }}</option>
            {% endfor %}
          </select>
        </div>
        <div>
          <label for="por_pagina">Por p√°gina</label>
          <select id="por_pagina" name="por_pagina">
            {% for opcao in [10, 25, 50, 100] %}
              <option value="{{ opcao }}" {% if opcao == por_pagina %}selected{% endif %}>{{ opcao }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="inline">
          <input id="ativos" name="ativos" type="checkbox" value="1" {% if apenas_ativos %}checked{% endif %}>
          <label for="ativos">Somente ativos</label>
        </div>
        <button type="submit">Aplicar filtros</button>
      </form>

      <div class="table-scroll">
        <div class="main-table-wrapper">
          <table class="main-table">
          <thead>
            <tr>
              <th>C√≥digo</th>
              <th>Pe√ßa</th>
              <th>Status</th>
              <th>A√ß√µes</th>
            </tr>
          </thead>
          <tbody>
            {% for item in itens %}
              <tr>
                <td>{{ item.codigo }}</td>
                <td>
                  <strong>{{ item.nome }}</strong><br>
                  <span class="muted">{{ item.tamanho }}{% if item.colaborador %} ¬∑ {{ item.colaborador }}{% endif %}{% if item.setor %} ¬∑ {{ item.setor }}{% endif %}</span>
                  <div>
                    <div>
                    <a class="back-link" href="{{ url_for('main.item_detalhe', item_id=item.id) }}">Ver hist√≥rico</a> |
                    <a class="back-link" href="{{ url_for('main.etiqueta_item', item_id=item.id) }}" target="_blank">üñ®Ô∏è Etiqueta</a> |
                    <a class="back-link" href="{{ url_for('main.editar_item', item_id=item.id) }}">‚úèÔ∏è Editar</a>
                  </div>
                  {% if not item.ativo %}
                    <div style="margin-top: 5px;">
                      <form method="post" action="{{ url_for('main.excluir_item', item_id=item.id) }}" style="display:inline;" onsubmit="return confirm('Tem certeza que deseja EXCLUIR PERMANENTEMENTE esta pe√ßa? Esta a√ß√£o n√£o pode ser desfeita.');">
                        <button type="submit" class="back-link" style="background:none;border:none;color:#e74c3c;cursor:pointer;">üóëÔ∏è Excluir Permanentemente</button>
                      </form>
                    </div>
                  {% endif %}
                </td>
                <td>
                  <span class="badge">{{ item.status|replace('_', ' ') }}</span>
                </td>
                <td>
                  {% if item.ativo %}
                    <details class="movimentacao">
                      <summary>Registrar movimenta√ß√£o</summary>
                      <span class="step">Passo 2</span>
                      <p class="helper">Atualize o status sempre que a pe√ßa mudar de local.</p>
                      <form method="post" action="{{ url_for('main.movimentar_item', item_id=item.id) }}">
                        <label for="status-{{ item.id }}">Status</label>
                        <select id="status-{{ item.id }}" name="status" required>
                          {% for status in status_options %}
                            <option value="{{ status }}" {% if status == item.status %}selected{% endif %}>{{ status|replace('_', ' ') }}</option>
                          {% endfor %}
                        </select>

                        <label for="colaborador-{{ item.id }}">Colaborador</label>
                        <select id="colaborador-{{ item.id }}" name="colaborador">
                          <option value="">‚Äî Selecione ‚Äî</option>
                          {% for colaborador in colaboradores_ativos %}
                            <option value="{{ colaborador.nome }}" {% if colaborador.nome == item.colaborador %}selected{% endif %}>{{ colaborador.nome }}</option>
                          {% endfor %}
                        </select>

                        <label for="setor-{{ item.id }}">Setor</label>
                        <select id="setor-{{ item.id }}" name="setor">
                          <option value="">‚Äî Selecione ‚Äî</option>
                          {% for setor in setores_ativos %}
                            <option value="{{ setor.nome }}" {% if setor.nome == item.setor %}selected{% endif %}>{{ setor.nome }}</option>
                          {% endfor %}
                        </select>

                        <label for="observacao-{{ item.id }}">Observa√ß√£o</label>
                        <input id="observacao-{{ item.id }}" name="observacao" placeholder="Ex.: retirado na rouparia">

                        <button type="submit">Registrar movimenta√ß√£o</button>
                      </form>
                      <form method="post" action="{{ url_for('main.inativar_item', item_id=item.id) }}">
                        <button type="submit">Inativar</button>
                      </form>
                    </details>
                  {% else %}
                    <span class="muted">‚Äî</span>
                  {% endif %}
                </td>
              </tr>
            {% else %}
              <tr>
                <td colspan="4" class="muted">Nenhum item encontrado.</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      <div class="pagination">
        <span>P√°gina {{ pagina }} de {{ total_paginas }} ({{ total_itens }} itens)</span>
        {% if pagina > 1 %}
          <a href="{{ url_for('main.index', pagina=pagina-1, busca=busca, status=filtro_status, setor=filtro_setor, colaborador=filtro_colaborador, ativos=1 if apenas_ativos else 0, por_pagina=por_pagina) }}">Anterior</a>
        {% endif %}
        {% if pagina < total_paginas %}
          <a href="{{ url_for('main.index', pagina=pagina+1, busca=busca, status=filtro_status, setor=filtro_setor, colaborador=filtro_colaborador, ativos=1 if apenas_ativos else 0, por_pagina=por_pagina) }}">Pr√≥xima</a>
        {% endif %}
      </div>
    </section>
  </div>
{% endblock %}

{% block scripts %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Setor select handler
    const setorSelect = document.getElementById('setor');
    const novoSetorContainer = document.getElementById('novo-setor-container');
    const novoSetorInput = document.getElementById('novo_setor_nome');
    
    if (setorSelect && novoSetorContainer) {
      setorSelect.addEventListener('change', function() {
        if (this.value === '__novo__') {
          novoSetorContainer.style.display = 'block';
          novoSetorInput.setAttribute('required', 'required');
        } else {
          novoSetorContainer.style.display = 'none';
          novoSetorInput.removeAttribute('required');
          novoSetorInput.value = '';
        }
      });
    }

    // Tamanho select handler
    const tamanhoSelect = document.getElementById('tamanho');
    const novoTamanhoContainer = document.getElementById('novo-tamanho-container');
    const novoTamanhoInput = document.getElementById('novo_tamanho_nome');
    
    if (tamanhoSelect && novoTamanhoContainer) {
      tamanhoSelect.addEventListener('change', function() {
        if (this.value === '__novo__') {
          novoTamanhoContainer.style.display = 'block';
          novoTamanhoInput.setAttribute('required', 'required');
        } else {
          novoTamanhoContainer.style.display = 'none';
          novoTamanhoInput.removeAttribute('required');
          novoTamanhoInput.value = '';
        }
      });
    }

    // Tipo peca select handler
    const tipoSelect = document.getElementById('nome');
    const novoTipoContainer = document.getElementById('novo-tipo-container');
    const novoTipoInput = document.getElementById('novo_tipo_nome');
    
    if (tipoSelect && novoTipoContainer) {
      tipoSelect.addEventListener('change', function() {
        if (this.value === '__novo__') {
          novoTipoContainer.style.display = 'block';
          novoTipoInput.setAttribute('required', 'required');
        } else {
          novoTipoContainer.style.display = 'none';
          novoTipoInput.removeAttribute('required');
          novoTipoInput.value = '';
        }
      });
    }

    // Colaborador select handler
    const colaboradorSelect = document.getElementById('colaborador');
    const novoColaboradorContainer = document.getElementById('novo-colaborador-container');
    const novoColaboradorInput = document.getElementById('novo_colaborador_nome');
    
    if (colaboradorSelect && novoColaboradorContainer) {
      colaboradorSelect.addEventListener('change', function() {
        if (this.value === '__novo__') {
          novoColaboradorContainer.style.display = 'block';
          novoColaboradorInput.setAttribute('required', 'required');
        } else {
          novoColaboradorContainer.style.display = 'none';
          novoColaboradorInput.removeAttribute('required');
          novoColaboradorInput.value = '';
        }
      });
    }
  });
</script>
{% endblock %}
